<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>AWS Step Functions and DAG - QuantBox</title><meta name=Description content="How to schedule a computation graph (DAG) on AWS Step Functions, ie serverless"><meta property="og:title" content="AWS Step Functions and DAG"><meta property="og:description" content="How to schedule a computation graph (DAG) on AWS Step Functions, ie serverless"><meta property="og:type" content="article"><meta property="og:url" content="https://quant.funcoder.net/posts/serverless-9-step-functions/"><meta property="og:image" content="https://quant.funcoder.net/posts/serverless-9-step-functions/header.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-07T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-07T20:54:03+00:00"><meta property="og:site_name" content="QuantBox"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://quant.funcoder.net/posts/serverless-9-step-functions/header.png"><meta name=twitter:title content="AWS Step Functions and DAG"><meta name=twitter:description content="How to schedule a computation graph (DAG) on AWS Step Functions, ie serverless"><meta name=application-name content="Quant Box - 你的量化工具箱"><meta name=apple-mobile-web-app-title content="Quant Box - 你的量化工具箱"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://quant.funcoder.net/posts/serverless-9-step-functions/><link rel=prev href=https://quant.funcoder.net/posts/insider_trade_pipeline/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"AWS Step Functions and DAG","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/quant.funcoder.net\/posts\/serverless-9-step-functions\/"},"image":[{"@type":"ImageObject","url":"https:\/\/quant.funcoder.net\/posts\/serverless-9-step-functions\/header.png","width":1878,"height":1380}],"genre":"posts","keywords":"aws, step-functions, stds, dag","wordcount":1597,"url":"https:\/\/quant.funcoder.net\/posts\/serverless-9-step-functions\/","datePublished":"2023-03-07T00:00:00+00:00","dateModified":"2023-03-07T20:54:03+00:00","publisher":{"@type":"Organization","name":"QuantBox","logo":{"@type":"ImageObject","url":"https:\/\/quant.funcoder.net\/images\/logo.png","width":1022,"height":984}},"author":{"@type":"Person","name":"FunCoder"},"description":"How to schedule a computation graph (DAG) on AWS Step Functions, ie serverless"}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9801985319378542" crossorigin=anonymous></script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=QuantBox>QuantBox</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=https://github.com/wangzhe3224/quant-box title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/posts/serverless-9-step-functions/ selected>English</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=QuantBox>QuantBox</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=https://github.com/wangzhe3224/quant-box title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/posts/serverless-9-step-functions/ selected>English</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">AWS Step Functions and DAG</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://github.com/wangzhe3224 title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>FunCoder</a></span>&nbsp;<span class=post-category>included in <a href=/categories/data-engineering/><i class="far fa-folder fa-fw" aria-hidden=true></i>Data Engineering</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-03-07>2023-03-07</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1597 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;8 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/serverless-9-step-functions/header.png data-srcset="/posts/serverless-9-step-functions/header.png, /posts/serverless-9-step-functions/header.png 1.5x, /posts/serverless-9-step-functions/header.png 2x" data-sizes=auto alt=/posts/serverless-9-step-functions/header.png title="How to schedule a computation graph (DAG) on AWS Step Functions, ie serverless"></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#oh-dag>Oh DAG!</a></li><li><a href=#existing-dag-based-engines>Existing DAG Based Engines</a></li><li><a href=#schedule-the-dag>Schedule The DAG</a></li><li><a href=#can-dag-go-serverless>Can DAG Go Serverless?</a><ul><li><a href=#topological-order>Topological Order</a></li><li><a href=#transitive-reduction>Transitive Reduction</a></li><li><a href=#pass-parameters>Pass Parameters</a></li><li><a href=#intermediate-results>Intermediate Results</a></li><li><a href=#general-lambda>General Lambda</a></li></ul></li><li><a href=#potential-issues>Potential Issues</a></li></ul></nav></div></div><div class=content id=content><h2 id=oh-dag>Oh DAG!</h2><p>Direct acyclic graph, DAG, is a popular data structure to organize large scale
computation. because it allows you to represent the dependencies between
different tasks in a clear and efficient manner. DAGs are commonly used in data
processing, scientific computing, and machine learning applications to manage
complex workflows.</p><p>Here are some key reasons why DAGs are useful for managing computation:</p><ul><li>Clear representation of dependencies: A DAG clearly shows the dependencies
between different tasks, making it easy to understand which tasks must be
completed before others can begin.</li><li>Efficient scheduling: With a DAG, it&rsquo;s easy to schedule tasks in the most
efficient way possible. By prioritizing tasks based on their dependencies, you
can ensure that each task is executed only when its input data is available,
which minimizes unnecessary waiting times.</li><li>Parallelism: DAGs can also be used to identify opportunities for parallelism,
which can significantly speed up computation. Tasks that don&rsquo;t have
dependencies can be executed in parallel, making better use of available
resources.</li><li>Incremental computation: DAGs can be used to efficiently perform incremental
computations, where only the necessary parts of a computation are re-run when
new data becomes available. This can save a significant amount of time and
resources compared to re-running the entire computation from scratch.</li></ul><p>Overall, DAGs are a powerful tool for managing complex computations, enabling
efficient scheduling, parallelism, and incremental computation, all while
providing a clear representation of dependencies between tasks.</p><p>As we can see, with DAG we can significantly parallelize our computations and the
power of DAG let us to do fearless concurrent computation which fits in the serverless
land very well.</p><h2 id=existing-dag-based-engines>Existing DAG Based Engines</h2><p>There are several libraries and frameworks that use DAGs for managing
computation. Here are some examples:</p><ul><li>Apache Airflow: Apache Airflow is a popular open-source platform for managing
workflows and data pipelines. It uses DAGs to represent the dependencies
between tasks, and provides a rich set of tools for scheduling, monitoring,
and executing tasks.</li><li>Dask: Dask is a Python library for parallel computing that uses DAGs to
represent computation graphs. It provides a flexible framework for executing
parallel and distributed computations on large datasets.</li><li>TensorFlow: TensorFlow is a popular machine learning library that uses DAGs to
represent computation graphs. It allows users to define complex machine
learning models as a series of interconnected nodes, with each node
representing a mathematical operation.</li><li>Luigi: Luigi is an open-source Python package for building data pipelines. It
uses DAGs to represent the dependencies between tasks, and provides a flexible
framework for scheduling and executing tasks.</li><li>Spark: Apache Spark is a popular distributed computing framework that uses
DAGs to represent computations. It provides a powerful set of tools for
parallel and distributed processing of large datasets.</li><li>These libraries and frameworks are just a few examples of the many tools that
use DAGs to manage computation. By using DAGs, these tools can provide a clear
representation of dependencies between tasks, efficient scheduling, and
parallelism, which can make it easier to manage complex workflows and large
datasets.</li></ul><p>There are also some libraries, such as Incremental (JaneStreet), Man MDF (Man Group),
loman, anchors, etc. More details please check: <a href=https://wangzhe3224.github.io/awesome-systematic-trading/#computation-graph target=_blank rel="noopener noreffer">https://wangzhe3224.github.io/awesome-systematic-trading/#computation-graph</a></p><h2 id=schedule-the-dag>Schedule The DAG</h2><p>Apart from describe the computation, another important aspect of using DAG for
computation is the <code>runtime</code> or <code>scheduling runtime</code>.</p><p>There are different ways to schedule DAG computation based on the nature of the
tasks, available resources, and performance goals. Here are some examples of
scheduling strategies:</p><ul><li>Serial scheduling: In this approach, tasks are executed in a sequential
manner, one after the other. This is the simplest scheduling strategy and may
be appropriate for small DAGs with a small number of tasks and dependencies.</li><li>Parallel scheduling: Tasks are executed concurrently, taking advantage of
multiple processors or threads. Parallelism can be used when tasks are
independent or can be executed in parallel without interfering with each
other. This can speed up computation significantly and is a common strategy
for large-scale computations.</li><li>Topological ordering: A topological ordering of the DAG is a linear ordering
of the nodes such that if there is an edge from node A to node B, then A comes
before B in the ordering. This ordering can be used to schedule tasks, with
tasks at the beginning of the ordering executed first, followed by tasks later
in the ordering.</li><li>Dynamic scheduling: In this approach, tasks are scheduled at runtime based on
the availability of data and resources. This can be useful when the execution
time of tasks is uncertain or when new tasks are added to the DAG at runtime.</li><li>Batch scheduling: In this approach, tasks are grouped into batches, and each
batch is executed in parallel. Batching can be useful when the DAG contains a
large number of tasks and parallelism can be used to speed up computation.</li><li>Pipeline scheduling: In this approach, tasks are divided into stages, and each
stage is executed in parallel. Each stage can have its own set of dependencies
and resources, allowing for efficient use of available resources. This
approach is commonly used in data processing and machine learning
applications.</li></ul><p>These scheduling strategies can be combined in different ways to optimize
performance and resource usage for a given DAG. The choice of scheduling
strategy depends on the characteristics of the DAG and the available resources.</p><h2 id=can-dag-go-serverless>Can DAG Go Serverless?</h2><p>Yes. As we discussed, there are two parts in computation with DAG: computing and
scheduling. Computing is the bread and butter of serverless, we have Lambda or
Fargate. However, scheduling is not that straightforward.</p><p>As shown above, most of the DAG based computation engine, such as Spark, we need a
long running session to coordinate the computation. This long run session need to
handle the scheduling of the jobs and handling the intermediate results.</p><p>Serverless is not very good at long running tasks. Luckily enough, AWS provides
a workflow service: <a href=https://aws.amazon.com/step-functions/ target=_blank rel="noopener noreffer">Step Functions</a>.</p><p>Step Functions is not a service designed for DAG computation, however we can make
it our DAG scheduling engine with a bit efforts.</p><h3 id=topological-order>Topological Order</h3><p>Say for example, I have following DAG:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302125219.png data-srcset="https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302125219.png, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302125219.png 1.5x, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302125219.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302125219.png title=20230302125219></p><p>First of all, we get the topological order of the DAG as show above.
With this order, the jobs are organized to several layers, for example, root node
is at layer 0, <code>xyz</code> are in layer 1, etc.</p><h3 id=transitive-reduction>Transitive Reduction</h3><p>Notice that there is a dependency from <code>x</code> to <code>x+(x+z)</code> node, which is a dependency
goes across two layers. This is not good! Because Step Function do not support this
kind of workflow. However, if we look at it closely, this dependency is redundant
in this setup, because by the time we reach <code>x+(x+z)</code>, <code>x</code> is guaranteed fulfilled.
This is called <code>transitive reduction</code>, meaning G = (V,E) is a graph G- = (V,E-) such that
for all v,w in V there is an edge (v,w) in E- if and only if (v,w) is
in E and there is no path from v to w in G with length greater than 1.</p><p>So we can reduce the graph:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302130459.png data-srcset="https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302130459.png, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302130459.png 1.5x, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302130459.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302130459.png title=20230302130459></p><p>This is nice and clean now and we can use Step Function to express this DAG now.</p><h3 id=pass-parameters>Pass Parameters</h3><p>Transitive reduction is good, however there are some node missing input information.
For example, <code>x+(x+z)</code> can never know it need to read <code>x</code>.</p><p>Using Step Functions to schedule DAG is a static scheduling, meaning we know exactly
the execution order, so we can encode the input and output into the config statically
before running the DAG, see input and output of AWS Step Function for details.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><h3 id=intermediate-results>Intermediate Results</h3><p>The next piece is how can we manage the intermediate results?</p><p>There could be many serverless solutions. For example, we can use S3. If we care
more about the latency, we can use ElasticCache.</p><h3 id=general-lambda>General Lambda</h3><p>The last piece is what&rsquo;s actually in the Lambda Invoke job in the Step Function
workflow?</p><p>This function should know how to load parameter from the intermediate store (previous step),
then should also know which function to call to compute the result, and at last
store the output to the store.</p><p>Here is some demo code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>store</span> <span class=o>=</span> <span class=n>S3Store</span><span class=p>(</span><span class=n>bucket</span><span class=o>=</span><span class=s2>&#34;some-bucket&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;store/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>handler</span><span class=p>(</span><span class=n>event</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Event example:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    {
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;component_name&#34;: &#34;HistDataLoader&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;component_config&#34;: {
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;symbol&#34;: &#34;ETHUSDT&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;freq&#34;: &#34;5m&#34;,
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;lookback&#34;: 1,
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;type&#34;: &#34;future&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        },
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;args&#34;: null,
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;kwargs&#34;: null
</span></span></span><span class=line><span class=cl><span class=s2>    }
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>component_name</span><span class=p>,</span> <span class=n>config</span><span class=p>,</span> <span class=n>args</span><span class=p>,</span> <span class=n>output</span> <span class=o>=</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;component_name&#39;</span><span class=p>],</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;component_config&#39;</span><span class=p>],</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;args&#39;</span><span class=p>],</span> <span class=n>event</span><span class=p>[</span><span class=s1>&#39;output&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>_cls</span> <span class=o>=</span> <span class=nb>getattr</span><span class=p>(</span><span class=n>components</span><span class=p>,</span> <span class=n>component_name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>obj</span> <span class=o>=</span> <span class=n>_cls</span><span class=p>(</span><span class=o>**</span><span class=n>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>obj</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>argv</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>arg</span> <span class=ow>in</span> <span class=n>args</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>d</span> <span class=o>=</span> <span class=n>store</span><span class=o>.</span><span class=n>read</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>path</span><span class=si>}{</span><span class=n>arg</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>argv</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>d</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>res</span> <span class=o>=</span> <span class=n>obj</span><span class=p>(</span><span class=o>*</span><span class=n>argv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>store</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>path</span><span class=si>}{</span><span class=n>output</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;output&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>path</span><span class=si>}{</span><span class=n>output</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h2 id=potential-issues>Potential Issues</h2><p>Some times, how to arrange the jobs in different layer is not straightforward.
Take following graph for example:</p><p><img class=lazyload src=/svg/loading.min.svg data-src=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302151157.png data-srcset="https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302151157.png, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302151157.png 1.5x, https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302151157.png 2x" data-sizes=auto alt=https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230302151157.png title=20230302151157></p><p>node <code>2x</code> only depends on <code>x</code>, however, if we follow the standard compilation method,
<code>2x</code> can only be executed after all <code>xyz</code> nodes finished.</p><p>Another way to schedule <code>2x</code> is to put it into the same layer of <code>xyz</code>, so that
<code>2x</code> executed immediately after <code>x</code> is done. However, in the way, we are risking
slow down the computation of the whole next layer. For example, if <code>2x</code> is a very
expensive computation in terms of time, it is better to schedule it in the next layer.</p><p>Take it further, event <code>2x</code> is scheduled in the next layer, the long computation
delay problem is not resolved but just pus the delay a bit further.</p><p>Fundamentally, if we cannot predict the runtime of each job, workflow approach
will suffer this type of issue.</p><p>In order to solve this potential issue, a dynamic scheduling is required, whereas
essentially workflow is a static scheduling.</p><p>I will leave that with another post.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://docs.aws.amazon.com/step-functions/latest/dg/concepts-input-output-filtering.html target=_blank rel="noopener noreffer">https://docs.aws.amazon.com/step-functions/latest/dg/concepts-input-output-filtering.html</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-03-07&nbsp;<a class=git-hash href=https://github.com/wangzhe3224/quant-box/commit/1a0a391646004734aada90d1dd821a5e38f5cb5a target=_blank title="commit by Zhe Wang(wangzhetju@gmail.com) 1a0a391646004734aada90d1dd821a5e38f5cb5a: serverless DAG">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>1a0a391</a></span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://quant.funcoder.net/posts/serverless-9-step-functions/ data-title="AWS Step Functions and DAG" data-hashtags=aws,step-functions,stds,dag><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://quant.funcoder.net/posts/serverless-9-step-functions/ data-hashtag=aws><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://quant.funcoder.net/posts/serverless-9-step-functions/><i class="fab fa-linkedin fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://quant.funcoder.net/posts/serverless-9-step-functions/ data-title="AWS Step Functions and DAG" data-web><i class="fab fa-whatsapp fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://quant.funcoder.net/posts/serverless-9-step-functions/ data-title="AWS Step Functions and DAG"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/aws/>aws</a>,&nbsp;<a href=/tags/step-functions/>step-functions</a>,&nbsp;<a href=/tags/stds/>stds</a>,&nbsp;<a href=/tags/dag/>dag</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/insider_trade_pipeline/ class=prev rel=prev title="Serverless Data Pipeline - SEC Insider Trades (Form 4)"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Serverless Data Pipeline - SEC Insider Trades (Form 4)</a></div></div><div id=comments><div id=disqus_thread class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><a href=https://github.com/sponsors/wangzhe3224>>> Sponsor Me <<</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://github.com/wangzhe3224 target=_blank>FunCoder</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://QuantBox.disqus.com/embed.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0,search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9229ZLLPT3",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-9229ZLLPT3" async></script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9801985319378542" crossorigin=anonymous></script></body></html>