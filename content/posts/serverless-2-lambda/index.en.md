---
title: "Systematic Trading Done Serverless (2) - Lambda"
date: 2023-02-04
draft: false
description: "(STDS) Part 2 - Compute with Lambda. What is lambda? Why using lambda? How to use lambda? and downside of lambda."
summary: "(STDS) Part 2 - Compute with Lambda. What is lambda? Why using lambda? How to use lambda? and downside of lambda."
tags: 
    - serverless
    - aws
    - lambda
    - systematic-trading
categories: 
    - Software Design
lightgallery: true
resources:
- name: featured-image
  src: lambda.jpeg
- name: featured-image-preview
  src: lambda.jpeg
---

`Lambda` is probably the most fundamental part of serverless architecture.  
`Lambda` is NOT silver bullet.

## What is `Lambda`

Here is a "official" definition from AWS: 

> AWS Lambda is a compute service that lets you run code without provisioning or
> managing servers. Lambda runs your code on a high-availability compute
> infrastructure and performs all of the administration of the compute
> resources, including server and operating system maintenance, capacity
> provisioning and automatic scaling, and logging.

Ok. Let's go unofficial.

It feels like aws `lambda` has a connections to Lambda Calculus, where lambda is a
symbol denoting the start of a function definition. And I think it is very helpful
to think `lambda` as a function.

lambda service is basically a runtime that gives you all the CPU/memory to 
run function you defined (code or binary).
It is a natural evolution of the virtualization of the computing. As shown below[^1].
Lambda removes the host/server from developer's mindset.

![20230204212854](https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230204212854.png "Where Lambda come from?")

I view `lambda` as a box with all resources (including CPU/Memory/Network/IO and connector to other services) ready except your code (computation/function/logic)

![20230204215240](https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230204215240.png "Lambda as a box")

In the blue box, you can put any code, say Python, Java, C#, or any binary generated by any language such as Go.

Although AWS has an [official list](https://docs.aws.amazon.com/lambda/latest/dg/lambda-runtimes.html) of supported languages,
with the customized runtime option, you can run binary generated from any languages such as Rust and C++.

## Why Using `Lambda`

### Cost

Surprisingly, the first reason is cost. You can argue that it seems any server can do what lambda can do! 
Yes, true. But with `lambda` you only pay what you used. By used I mean CPU/memory resources.

If your lambda functions runs 100ms with 128 MB memory, you pay only that part. 
whereas in the hosting model, you pay for the host even you don't run any function. 
(since you always have to run a operating system for the host to do anything).

We know that a lot of computing has a busty nature, ie sometime the computation 
load is heavy and some time idle. In addition, not all computation require same
resources. Having the ability to tailer the resources for different functions 
can save cost.

> Systematic Trading Context:  
> - Reducing cost is increasing profit, easy.

### Auto Scaling

Both horizontal and vertical scaling are done easily with `lambda`. 

For horizontal scaling, we pretty much do nothing. AWS almost has no cap on how 
many `lambda` instances you can run concurrently.

For vertical scaling, we just need to specify the memory resource we want. CPU
come with memory setup. Although for now AWS has a memory cap at 10 Gb.

> Systematic Trading Context
> - A lot computation pattern has a busty property. For example, ad-hoc research backtesting, or during some market hours we need to sample more frequently. For stock market, we don't even trade during holidays.

### Language Independent

`lambda` makes writing software in different language so easy. You can build 
computation intensive function with language like Rust, whereas build routing 
component with NodeJs. Then you can compose them as they were done in the same
language.

Although writing application in different languages is a double edged sword,
`lambda` grant developer this ability to do so.

As I mentioned before, serverless architecture encourages micro-services and 
event-driven design. this ability of `lambda` powers the idea.

> Systematic Trading Context  
> - Tackle bottlenecks with suitable languages

### Encourage Event-Driven Design

`lambda` on it's own cannot do much, we need ways to invoke/trigger our functions.
And `lambda` has lots of event triggers: a api call, a message in the queue, or
a scheduler, etc.

`lambda` can interact with pretty much every single aws services.

![20230204225812](https://raw.githubusercontent.com/wangzhe3224/pic_repo/master/images/20230204225812.png "Event Triggers")

This event-driven nature makes integrating `lambda` with other services easy.
Hence encouraging event-driven design.

Event-driven design has a good ability to extend and audit.

> Systematic Trading Context  
> Systematic trading is a fast evolving business, hence the some parts of the system are constantly changing
> and audibility is very important as well.

## How to Use `Lambda`

In concept:

- Define resource specification
    - Memory
    - Runtime
    - Environment Variables
    - Permission
- Define trigger event(s)
    - API Call
    - A message from queue
    - A message from event broker
    - Any event emit from other aws services
- Upload code or binary

In details? We definitely need a separate post.

There is another aspect of "how" to use, which is what kind of computation can we use lambda?

- Web applications
- Data processing pipelines
- Parallelized computing
- Internet of Things (IoT)

In this series, we are particularly interested in Data processing amd Parallelized computing.

## Why Not Using `Lambda`

With the gain of lambda, there are some drawbacks:

- Lose of
  - low level control
  - server tuning
  - latency variance control
  - state ( lambda supposed to be stateless )
- A lot of async function can make tracking/debugging system hard.
- Lambda's 10 gb resource limit is not great ( there is another serverless service call `Fargate` is designed for larger computation. )

## Last thought

AWS `lambda` is the fundamental building block of serverless architecture.
The benefit of lambda is reducing cost, flexibility, and scaling.
In the mean time, there are some drawbacks with `lambda` such as latency variance, tracing complexity.

In the systematic trading context, `lambda` can be used to do different kind of computations, 
for example, ad-hoc backtest/simulations, scheduled jobs, sample-based trading systems. 

Among all the drawbacks, latency variance probably is my biggest concern because
some parts of the system do need stable latency ( not necessary low latency ).

## References

- [Lambda Operator Guide](https://docs.aws.amazon.com/lambda/latest/operatorguide/tradeoffs-event-driven.html)
- [Serverless Design Principles](https://docs.aws.amazon.com/wellarchitected/latest/serverless-applications-lens/general-design-principles.html)
- [[SVS311]Practical experience with a serverless-first strategy at Capital One](https://www.youtube.com/watch?v=NZVNAEK6shc)
    - Lambda tuning
    - Best/worst practices
[^1]: [AWS Lambda Introduction - What is it and Why is it Useful?](https://www.youtube.com/watch?v=UsaiOEFdfs0)